# 软件包和网络管理

## 一、软件包

类型：

源码包（需要编译）和二进制包（已编译）

二进制包：

centos:rpm 工具：rpm、 yum

ubuntu:dpkg 工具：dpkg、apt



### yum/dnf

#### 官方源

- 阿里云镜像：https://mirrors.aliyun.com/rockylinux/
- 腾讯云镜像：https://mirrors.cloud.tencent.com/rocky/
- 中科大镜像：https://mirrors.ustc.edu.cn/rocky/
- 上海交大镜像：https://mirrors.sjtug.sjtu.edu.cn/rocky/
- 西安交大镜像：https://mirrors.xjtu.edu.cn/rocky/
- 浙江大学镜像：https://mirrors.zju.edu.cn/rocky/
- 南京大学镜像：https://mirrors.nju.edu.cn/rocky/

```bash
# 换源
# 备份原来的源
[root@localhost ~]# mkdir /repobackup
[root@localhost ~]# cp /etc/yum.repos.d/* /repobackup/
# 使用sed命令，替换原来repo文件中的内容
[root@localhost ~]# sed -e 's|^mirrorlist=|#mirrorlist=|g' \
    -e 's|^#baseurl=http://dl.rockylinux.org/$contentdir|baseurl=https://mirrors.ustc.edu.cn/rocky|g' \
    -i.bak \
    /etc/yum.repos.d/rocky-extras.repo \
    /etc/yum.repos.d/rocky.repo
[root@localhost ~]# yum clean all     # 清空缓存及其他文件
[root@localhost ~]# yum makecache     #重建缓存
[root@localhost ~]# yum repolist      # 查询源
```

软件源相关文件存放的位置`/etc/yum.repos.d/`

```bash
[root@localhost ~]# ls /etc/yum.repos.d/     #查看软件源
```



#### yum常用命令

```bash
#yum清空缓存列表
yum clean packages 			# 清除缓存目录下的软件包，清空的是(/var/cache/yum)下的缓存
yum clean headers 			# 清除缓存目录下的 headers
yum clean oldheaders 		# 清除缓存目录下旧的 headers
yum clean, yum clean all (= yum clean packages; yum clean oldheaders) 	# 清除缓存目录下的软件包及旧的headers
yum 安装一个软件的时候会把软件包下载到本地指定的目录中，所以为了节省磁盘空间，可以用上述命令清空缓存

#yum显示信息
yum list          				# yum list显示所有已经安装和可以安装的程序包   
yum list <package_name> 		# 显示安装包信息rpm，显示installed ，这里是包名，版本和仓库名
yum list repolist all			#查询所有的yum仓库
yum info <package_name>         #显示安装包rpm的详细信息
yum groupinfo <group_name>      #显示程序组group信息

#yum搜索、查看
yum search string 				#根据关键字string查找安装包
yum deplist <package_name>		# 仅仅 查看程序rpm依赖情况
yum provides */命令				# 查看命令是由哪个包提供的（这个命令很有帮助）

#yum安装
yum -y install <package_name>	#不加-y则会询问是否安装，想控制哪些包安装，则不要加-y，想自动安装不进行交互，则加-y
yum install --downloadonly --downloaddir=/xx/xxx/xx/	#只下载软件但不安装

#yum删除、卸载程序
yum remove <package_name>		# 卸载程序包，此卸载命令会yum或rpm安装的包生效，如果是编译安装的，则不受

#yum控制
yum groupremove <group_name>	# 删除程序组group
yum包的升级、降级
yum check-update 				#检查可更新的软件有哪些
yum update 						#更新升级所有软件包
yum update <package_name> 		#更新指定程序包package，   
yum upgrade <package_name> 		#升级指定程序包package

#有时候需要将高版本的依赖降级到低版本，降级命令如下
yum downgrade <package_name>	#降级，对于有依赖的，yum不会自动降级，需要手动降级依赖项

#yum 组的管理
yum groupinstall
```



#### 查找软件包

```bash
1. 通过命令的名字查找是属于哪个软件包
[root@localhost ~]# yum provides xxx
2. 通过配置文件查找属于哪个软件包提供的
[root@localhost ~]# yum provides /etc/ssh/sshd_config
3. 通过search参数查找
[root@localhost ~]# yum search xxx
4. 查看系统中的安装包
[root@localhost ~]# yum list installed            # 查看已安装的所有软件包
[root@localhost ~]# yum list                      # 查看所有可以安装的软件包
[root@localhost ~]# yum list xxx
```



#### 安装软件包

```bash
[root@localhost ~]# yum install xxx   -y :-y一律允许
[root@localhost ~]# yum install xxx yyy zzz              # 多个软件包之间用空格隔开
[root@localhost ~]# yum reinstall xxx                    # 重新安装
[root@localhost ~]# yum update xxx                       # 更新软件包的版本-laster
[root@localhost ~]# yum update                           # 更新所有软件包到软件仓库的最新版本

[root@localhost ~]# yum -y install /root/httpd-2.4.6-93.el7.centos.x86_64.rpm     
# 从本地安装
[root@localhost ~]# yum -y install http://centos.ustc.edu.cn/centos/7/os/x86_64/Packages/httpd-2.4.6-93.el7.centos.x86_64.rpm    
# 从URL安装

- 软件包组就是把一些相关的软件包给整合起来，可以打包安装和卸载  类似单个软件安装
[root@localhost ~]# yum grouplist    # 查看可用的软件包组
[root@localhost ~]# yum groupinstall "xxx"
[root@localhost ~]# yum groupinfo "GNOME xxx"
```

#### 卸载

```bash
[root@localhost ~]# yum -y remove xxx                     # 卸载httpd软件包
[root@localhost ~]# yum -y groupremove "xxx"              # 卸载软件包组
```

#### 历史记录

```bash
[root@localhost ~]# yum history
用来查看 yum 软件包管理器执行的历史记录的

[root@localhost ~]# yum history info 4                    # 查看具体某个yum记录的信息
[root@localhost ~]# yum history undo 4                    # 回滚/撤销某个操作
[root@localhost ~]# yum history new                       # 情况所有yum历史记录
```



#### yum自建源

除了使用上述提到的官方源之外，我们也可以自己搭建一个自建源用来为系统提供软件仓库

1.可以使用本地的iso软件包当作源

```bash
- 挂载本地ISO光盘：
[root@localhost ~]# mount /dev/cdrom /media/cdrom

- 清空原有的软件仓库
[root@localhost ~]# rm -f /etc/yum.repos.d/*

- 配置本地yum
[root@localhost ~]# vim /etc/yum.repos.d/local.repo
[BaseOS]
name=RockyLinux 9.4 BaseOS
baseurl=file:///media/cdrom/BaseOS
enabled=1
gpgcheck=0

[AppStream]
name=RockyLinux 9.4 AppStream
baseurl=file:///media/cdrom/AppStream
enabled=1
gpgcheck=0
```



2.使用其他机器通过http或者ftp提供给内网中的安装软件包

第一步：下载软件包，可以使用`--downloadonly`选项仅下载不安装

```bash
[root@localhost ~]# yum clean all                        # 清理缓存和下载的包
[root@localhost ~]# yum update --downloadonly                       # 下载软件包
[root@localhost ~]# ls /var/cache/yum/x86_64/7/base/packages/    # 查看下载的包
```

第二部：将软件包放到合适的位置上，并且创建软件数据

```bash
[root@localhost ~]# mkdir /var/ftp/update
[root@localhost ~]# find /var/cache/yum/x86_64/7/updates -iname "*.rpm" -exec cp -rf {} /var/ftp/update/ \; # 或者: cp /var/cache/yum/x86_64/7/base/packages/*  /var/ftp/update
[root@localhost ~]# yum -y install createrepo              # createrepo用来创建软件包的索引
[root@localhost ~]# createrepo /var/ftp/update/            # 创建软件包的索引
```

第三步：部署ftp文件服务器，将软件包通过ftp协议共享给sever2

```bash
# 部署ftp服务并且启动
[root@localhost ~]# yum -y install vsftpd    
[root@localhost ~]# systemctl start vsftpd

# 关闭防火墙和selinux
[root@localhost ~]# systemctl stop firewalld
[root@localhost ~]# setenforce 0
```



### RPM

将rpm包下载到本地，然后使用rpm工具来安装这个软件包

```bash
# 格式说明
[root@atopos ~]# rpm -ivh httpd-2.4.6-93.el7.centos.x86_64.rpm
- httpd：包名
- 2：主版本号
- 4：次版本号
- 6：修订次数，指的是第几次修改bug
- 93：release（第几次发布，指的是简单的修改参数）
- e17：操作系统版本
- x86_64：64位操作系统
```



#### 命令格式

 ```shell
 [root@atopos ~]# rpm [选项] 软件包
 #安装
   -i：install的意思，安装软件包
   -v：显示附加信息，提供更多详细信息
   -V：校验，对已安装的软件进行校验
  
 #查询
   -q：查询，一般跟下面的参数配合使用
   -a：查询所有已安装的软件包
   -f：系统文件名（查询系统文件属于哪个安装包）
   -i：显示已安装的rpm软件包信息
   -l：查询软件包文件的安装位置
   -p：查询未安装软件包的相关信息
   -R：查询软件包的依赖性
  
 #卸载
   -e：erase
   --nodeps：忽略依赖
  
  升级
   -U：一般配合vh使用
 ```

  

### wget

#### wget 介绍

wget 是一个从网络上自动下载文件的自由工具，支持通过 HTTP、HTTPS、FTP 三个最常见的 TCP/IP协议 下载，并可以使用 HTTP 代理。"wget" 这个名称来源于 "World Wide Web"与 "get" 的结合。所谓自动下载，是指 wget 可以在用户退出系统的之后在继续后台执行，直到下载任务完成。



#### wget 语法

```bash
语法：wget [OPTION]... [URL]...   #OPTION是参数   URL下载的地址
```



#### wget 常用参数

| **参数**                      | **用法**                                                     |
| ----------------------------- | ------------------------------------------------------------ |
| -V, --version                 | 显示`wget`的版本信息并退出                                   |
| -h, --help                    | 打印帮助信息，显示命令手册。                                 |
| -b, --background              | 启动后转入后台运行。                                         |
| -o, --output-file=FILE        | 将日志消息记录到指定的文件中。                               |
| -a, --append-output=FIL       | 将日志消息追加到指定的文件中。                               |
| -q, --quiet                   | 静默模式，下载过程中不输出任何信息。                         |
| -v, --verbose                 | 显示详细信息（默认选项）。                                   |
| -c, --continue                | 断点续传，如果下载过程中出现中断，则在新的终端重新使用`wget`命令，并加上该参数，即可从`断点处`继续下载。该参数在下载大文件时非常实用。 |
| -P, --directory-prefix=PREFIX | 指定下载文件保存的目录，默认会在当前目录下保存，可以使用该参数指定保存的目录。 |
| -O, --output-document=FILE    | 将下载的文件写入指定的文件中，也就是对下载的文件名进行重新命名（重命名） |
| -t, --tries=NUMBER            | 设置重试次数为指定的数字（0为无限次数），当下载失败时重新尝试的次数。 |
| -T, --timeout=SECONDS         | 将所有超时值设置为指定的秒数，也就是超时时间，当多少秒内还没下载完就超时结束。 |
| -w, --wait=SECONDS            | 在每次下载之间等待指定秒数。                                 |
| -i, --input-file=FILE         | 从本地或外部文件中读取`URL列表`进行下载，这个URL列表一般存放在一个文件中。 |
| --limit-rate=RATE             | 限制下载速率为指定的速率。默认情况下，`wget`命令会以全速下载，但是有时下载一个非常大的资源的话，可能会占用大量的可用带宽，影响其他使用网络的任务，这时就要限制下载速度。 |
| -U, --user-agent=AGENT        | 将`用户代理`标识设置为指定的代理，而不是默认`Wget`版本号，也就是如果远程服务器阻止wget下载资源，我们可以通过-U选项模拟浏览器进行下载。 |
| --spider                      | 仅检查`URL`，判断这个URL是否存在远程文件，不下载任何内容。   |
| -Q, --quota=NUMBER            | 设置下载配额为指定的数字，限制总下载文件大小。               |
| --report-speed=TYPE           | 以指定的方式输出带宽信息。TYPE可以是bits。                   |
| -F, --force-html              | 将输入文件视为`HTML文件`。                                   |
| -nc , --no-clobber            | 跳过已存在文件的下载（不覆盖它们）。                         |
| -N, --timestamping            | 只有当远程文件新于本地文件时才重新下载。                     |
| -S, --server-response         | 打印服务器的响应。                                           |
| --connect-timeout=SECS        | 设置连接超时时间为指定的秒数。                               |
| --read-timeout=SECS           | 设置读取超时时间为指定的秒数。                               |
| --waitretry=SECONDS           | 在重试下载之间等待1到指定的秒数。                            |
| --no-proxy                    | 明确禁用代理。                                               |
| --restrict-file-names=OS      | 限制文件名中允许的字符为`操作系统`允许的字符。               |
| -4, --inet4-only              | 仅连接IPv4地址。                                             |
| -6, --inet6-only              | 仅连接IPv6地址。                                             |
| --user=USER                   | 将FTP和HTTP用户设置为指定的用户。                            |
| --password=PASS               | 将FTP和HTTP密码设置为指定的密码。                            |
| --ask-password                | 提示输入密码。                                               |
| --unlink                      | 在覆盖之前删除文件。                                         |



### 源码包管理

源码包获得途径：

官方网站，如：

apache: www.apache.org

nginx: www.nginx.org

编译源码包需要配置环境：

这取决于源码所使用的编程语言和框架等，但是Linux基础软件包一般都是由C语言编写的，所以我们使用较多的编译环境为`gcc`、`make`等等



#### 编译

源码包编译三部曲

```bash
yum install -y ncurses* gcc gcc-c++ make #bian
- 第一步：
./configure #可以指定安装路径，启用或者禁用功能等，最终生成makefile

- 第二步
make #按Makefile文件编译。可以加 -j 2 参数使用两个cpu核心进行编译

- 第三步
make install#按Makefile定义的文件路径安装

make clean#清除上一次make命令所产生的object文件，要重新执行
configure时，需要执行make clean。
```



### 压缩与解压缩

**打包一个文件或者目录**：

```bash
tar -cvf archive.tar(生成的目标压缩包名) /path/to/directory（要压缩的目标）

-c 表示创建一个新的归档文件。
-v 表示在压缩过程中显示详细信息（verbose 详细模式）。
-f 指定归档文件的名称。

# 如果要创建gzip压缩包
tar -zcvf archive.tar.gz /path/to/directory
```

**解压缩：**

```bash
tar -xvf archive.tar（要解压的目标）

-x 表示解压缩。
-v 表示显示详细信息。
-f 指定要解压缩的归档文件。

# 如果归档文件是使用 gzip 压缩的，比如 archive.tar.gz，则需要添加 -z 选项：

tar -zxvf archive.tar.gz
```



## 二、网络管理

### DHCP

DHCP（动态主机配置协议），主要用于给设备自动分配IP地址以及网络信息，以便网络设备能够连接到网络并进行通信



#### DHCP工作过程

1. 客户端启动时发送 DHCP 发现(DHCPDISCOVER)广播消息,寻找 DHCP 服务器。
2. DHCP 服务器收到广播消息后,会提供一个未被使用的 IP 地址以及其他网络配置信息(如子网掩码、默认网关、DNS 服务器等),并发送 DHCP 提供(DHCPOFFER)消息给客户端。
3. 客户端收到一个或多个 DHCP 提供消息后,会选择其中一个 DHCP 服务器提供的 IP 地址,并发送 DHCP 请求(DHCPREQUEST)消息确认。
4. DHCP 服务器收到客户端的 DHCP 请求消息后,会将该 IP 地址分配给客户端,并发送 DHCP 确认(DHCPACK)消息给客户端。
5. 客户端收到 DHCP 确认消息后,就可以使用分配到的 IP 地址和其他网络配置参数连接到网络了。



#### DHCP续租

DHCP分配的信息是有有效期的，再租约时间快到的时候，如果我们想要继续使用这个地址信息，就需要向DHCP服务器续租

查看Linux上的网络配置信息，该信息位于centos:`/etc/sysconfig/network-scripts/ifcfg-ens33`

rockyLinux:`/etc/NetworkManager/system-connection/ens160.nmconnection`

```bash
[root@localhost ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens33
```



### DNS（域名解析）

DNS(Domain Name System) 是一套从域名到IP的映射的协议

机制：

- 一个组织的系统管理机构，维护系统内的每个主机的`IP和主机名`的对应关系
- 如果新计算机接入网络，将这个信息注册到`数据库`中
- 用户输入域名的时候，会自动查询`DNS`服务器，由`DNS服务器`检索数据库, 得到对应的IP地址。



#### 域名

主域名是用来识别主机名称和主机所属的组织机构的一种分层结构的名称。 例如：[http://www.baidu.com(域名使用.连接](http://www.baidu.xn--com(-et6f94vu7gxx9d.xn--gzu679g/))

- com： 一级域名，表示这是一个企业域名。同级的还有 "net"(网络提供商)，"org"(非盈利组织) 等。
- baidu: 二级域名, 公司名。
- www: 只是一种习惯用法，并不是每个域名都支持。
- http:// : 要使用什么协议来连接这个主机名。



#### 域名解析的过程

1. 浏览器发起域名解析，首先查询浏览器缓存，如果没有，就查询hosts文件，如果没有就提出域名解析请求
2. 客户机提出域名解析请求，并将该请求发送给本地的域名服务器。
3. 当本地的域名服务器收到请求后,就先查询本地的缓存,如果有该纪录项,则本地的域名服务器就直接把查询的结果返回。
4. 如果本地的缓存中没有该纪录,则本地域名服务器就直接把请求发给根域名服务器,然后根域名服务器再返回给本地域名服务器一个所查询域(根的子域)的主域名服务器的地址。
5. 本地服务器再向上一步返回的域名服务器发送请求,然后接受请求的服务器查询自己的缓存,如果没有该纪录,则返回相关的下级的域名服务器的地址。
6. 重复第四步,直到找到正确的纪录。
7. 本地域名服务器把返回的结果保存到缓存,以备下一次使用,同时还将结果返回给客户机



### 配置网络服务

#### 图形化配置网络

使用nmtui命令来配置网络

```bash
[root@localhost ~]# nmtui
```



#### 命令行配置网络

```bash
# 修改网卡配置文件
#centos系统
[root@localhost ~]# vim /etc/sysconfig/network-scripts/ifcfg-ens33 
#RockyLinux系统
[root@localhost ~]# vim /etc/NetworkManager/system-connections/ens160.nmconnection
```

当修改完Linux系统中的服务配置文件后，并不会对服务程序立即产生效果。要想让服务程序获取到最新的配置文件，需要手动重启相应的服务，之后就可以看到网络畅通了

```bash
[root@localhost ~]# systemctl restart network   
[root@localhost ~]# systemctl restart NetworkManager  # RockyLinux
[root@localhost ~]# ping baidu.com
```

网卡配置文件centos ifcfg-ens33参数

| 解释         | 参数                        |
| ------------ | --------------------------- |
| 设备类型     | TYPE=Ethernet               |
| 地址分配模式 | BOOTPROTO=static(静态)/dhcp |
| 网卡名称     | NAME=ens33                  |
| 是否启动     | ONBOOT=yes                  |
| IP地址       | IPADDR=192.168.99.136       |
| 子网掩码     | NETMASK=255.255.255.0       |
| 网关地址     | GATEWAY=192.168.88.2        |
| DNS地址      | DNS1=114.114.114.114        |

- 配置完成以后，需要重启网卡才可以生效



### nmcli 工具详解

nmcli命令是redhat7或者centos7之后的命令，该命令可以完成网卡上所有的配置工作，并且可以写入 配置文件，永久生效。创建一个链接到真实网卡上

- 查看接口状态

```bash
[root@localhost ~]# nmcli device status 
```

- 查看链接信息

```bash
[root@localhost ~]# nmcli connection show
```

- 配置IP等网络信息    **nmcli配置时，必须写上网络位是多少，否则会认为32位全部都是网络位**

```bash
[root@localhost ~]# mcli con mod "ens33" ipv4.addresses 192.168.88.140/24 ipv4.gateway 192.168.88.2 ipv4.dns "8.8.8.8,8.8.4.4" ipv4.method manual
```

- 启动/停止接口

```bash
[root@localhost ~]# nmcli connection up ens33
[root@localhost ~]# nmcli connection down ens33
```

- 创建链接

```bash
[root@localhost ~]# nmcli connection add type ethernet con-name dhcp_ens33
ifname ens33
```

- 删除链接

```bash
[root@localhost ~]# nmcli connection delete dhcp_ens33
```



### ifconfig

- ifconfig 命令用于显示或设置网络设备。

**安装(需要安装该软件包才能使用ifconfig)：**`yum install -y net-tools`

#### 语法

```shell
ifconfig [network_interface]
         [down|up]
         [add <address>]
         [del <address>]
         [hw <type> <hw_address>]
         [io_addr <I/O_address>]
         [irq <IRQ>]
         [media <media_type>]
         [mem_start <memory_address>]
         [metric <number>]
         [mtu <bytes>]
         [netmask <netmask>]
         [tunnel <address>]
         [-broadcast <address>]
         [-pointopoint <address>]
         [<IP_address>]
```

选项:

- `down`/`up`: 禁用/启用网络接口
- `add <address>`/`del <address>`: 添加或删除 IP 地址
- `hw <type> <hw_address>`: 设置硬件地址 (MAC 地址)
- `io_addr <I/O_address>`: 设置 I/O 地址
- `irq <IRQ>`: 设置中断请求
- `media <media_type>`: 设置网络媒体类型
- `mem_start <memory_address>`: 设置内存起始地址
- `metric <number>`: 设置路由度量值
- `mtu <bytes>`: 设置 MTU 值
- `netmask <netmask>`: 设置子网掩码
- `tunnel <address>`: 设置隧道地址
- `-broadcast <address>`: 设置广播地址
- `-pointopoint <address>`: 设置点对点地址
- `<IP_address>`: 设置 IP 地址



- 显示网络设备信息

```bash
[root@localhost ~]# ifconfig
```

- 启动关闭指定网卡

```bash
[root@localhost ~]# ifconfig ens33 down
[root@localhost ~]# ifconfig ens33 up
```

- 配置IP地址

```bash
[root@localhost ~]# ifconfig eth0 192.168.1.56 
[root@localhost ~]# ifconfig eth0 192.168.1.56 
//给eth0网卡配置IP地址
[root@localhost ~]# ifconfig eth0 192.168.1.56 netmask 255.255.255.0 
// 给eth0网卡配置IP地址,并加上子掩码
[root@localhost ~]# ifconfig eth0 192.168.1.56 netmask 255.255.255.0 broadcast 192.168.1.255
// 给eth0网卡配置IP地址,加上子掩码,加上个广播地址
```

- 设置最大传输单元

```bash
[root@localhost ~]# ifconfig eth0 mtu 1500 
//设置能通过的最大数据包大小为 1500 bytes
```



# 总结

1.Linux网络管理：

​	IP地址：用来标识网络中的主机

​	网关（Gateway）:网络出口，数据包从需要的网关出去到达外网

​		在vmware模拟的网卡中，网关是192.168.xxx.2

​		192.168.xxx.1是Windows中vmware虚拟出来的一个叫做vmwarerent8的地址

​	子网掩码：子网掩码用于区分网络位和主机位的

​	DNS（域名解析服务）：将域名和IP地址的对应关系存起来，由DNS服务器来存

​	DHCP（动态主机配置协议）：服务器自动位用户分配IP地址等网络信息

​	Linux更改网络配置的几个方法：

​		vim /etc/sysconfig/network-script/ifcfg-ens33

​		nmtui 图形化更改网络设置

​		nmcli 命令行更改网络设置

​		ifconfig 修改

​	不管哪个方法都要，编辑完重启主机，使之生效



2.Linux软件包管理：

​	类型：源码包（源代码）、二进制包（操作系统已经编译完的）

​	yum 在线下载安装，自动解决依赖问题，需要配置合适的yum源

​	查询：

​		yum provides xxx

​		yum search xxx

​	安装：

​		yum install -y xxx xxx xxx

​	卸载：

​		remove -y xxx

​	rpm用于本地安装rpm软件包，需要手动解决依赖问题

​		rpm -ivh xxx

​		rpm -e xxx

​		rpm -Uvh xxx

​		rpm -q[a,c,l,,,]

​	源码包：

​		先下载到本地，再解压，安装编译所需环境

​		编译：        ./configure       用于否启用或禁用某些功能xxxx     最终会生成一个makefile

​							make          按照生成的makefile来编译整个源码

​							make install         安装到指定位置